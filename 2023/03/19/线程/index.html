<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>线程 | 飘渺之旅</title><meta name="author" content="c4rich"><meta name="copyright" content="c4rich"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="1，概述1.1，程序，进程，线程的关系程序是静态的，运行起来这后就在操作系统里面生成了一个进程 线程是CPU执行的最不单元，它位于进程里面，一个进程里面至少得有一个线程 1.2，单线程程序和多线程程序12单线程程序：即，若有多个任务只能依次执行。当上一个任务执行结束后，下一个任务才开始执行。多线程程序：即，若有多个任务可以同时执行。多个任务可以并发执行。  1.3，JAVA程序的运行原理JVM">
<meta property="og:type" content="article">
<meta property="og:title" content="线程">
<meta property="og:url" content="https://c4rich.github.io/2023/03/19/%E7%BA%BF%E7%A8%8B/index.html">
<meta property="og:site_name" content="飘渺之旅">
<meta property="og:description" content="1，概述1.1，程序，进程，线程的关系程序是静态的，运行起来这后就在操作系统里面生成了一个进程 线程是CPU执行的最不单元，它位于进程里面，一个进程里面至少得有一个线程 1.2，单线程程序和多线程程序12单线程程序：即，若有多个任务只能依次执行。当上一个任务执行结束后，下一个任务才开始执行。多线程程序：即，若有多个任务可以同时执行。多个任务可以并发执行。  1.3，JAVA程序的运行原理JVM">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2023-03-19T15:12:40.000Z">
<meta property="article:modified_time" content="2023-03-28T15:07:44.548Z">
<meta property="article:author" content="c4rich">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Javase">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://c4rich.github.io/2023/03/19/%E7%BA%BF%E7%A8%8B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '线程',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-28 23:07:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://raw.iqiq.io/qihuancode/images/dev/img/202303192049233.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="飘渺之旅"><span class="site-name">飘渺之旅</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">线程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-19T15:12:40.000Z" title="发表于 2023-03-19 23:12:40">2023-03-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-28T15:07:44.548Z" title="更新于 2023-03-28 23:07:44">2023-03-28</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="线程"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2023/03/19/%E7%BA%BF%E7%A8%8B/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2023/03/19/%E7%BA%BF%E7%A8%8B/" itemprop="commentCount"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1，概述"><a href="#1，概述" class="headerlink" title="1，概述"></a>1，概述</h1><h2 id="1-1，程序，进程，线程的关系"><a href="#1-1，程序，进程，线程的关系" class="headerlink" title="1.1，程序，进程，线程的关系"></a>1.1，程序，进程，线程的关系</h2><p>程序是静态的，运行起来这后就在操作系统里面生成了一个进程</p>
<p>线程是CPU执行的最不单元，它位于进程里面，一个进程里面至少得有一个线程</p>
<h2 id="1-2，单线程程序和多线程程序"><a href="#1-2，单线程程序和多线程程序" class="headerlink" title="1.2，单线程程序和多线程程序"></a>1.2，单线程程序和多线程程序</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">单线程程序：即，若有多个任务只能依次执行。当上一个任务执行结束后，下一个任务才开始执行。</span><br><span class="line">多线程程序：即，若有多个任务可以同时执行。多个任务可以并发执行。</span><br></pre></td></tr></table></figure>

<h2 id="1-3，JAVA程序的运行原理"><a href="#1-3，JAVA程序的运行原理" class="headerlink" title="1.3，JAVA程序的运行原理"></a>1.3，JAVA程序的运行原理</h2><p>JVM   JAVA 虚拟机【跨平台】</p>
<p>GC  垃圾回收 它是一个后台守护线程</p>
<p>JVM虚拟机的启动是单线程的还是多线程的?</p>
<p>答案是多线程。原因是垃圾回收线程也要先启动，否则很容易会出现内存溢出。现在的垃圾回收线程加上前面的主线程，最低启动了两个线程，所以，JVM的启动其实是多线程的。</p>
<h2 id="1-4，并发和并行的说明"><a href="#1-4，并发和并行的说明" class="headerlink" title="1.4，并发和并行的说明"></a>1.4，并发和并行的说明</h2><h3 id="1-4-1，并发"><a href="#1-4-1，并发" class="headerlink" title="1.4.1，并发"></a>1.4.1，并发</h3><p>指在同一时刻只能有一条指令执行，但多个进程指令被快速的轮换执行，使得在宏观上具有多个进程同时执行的效果，但在微观上并不是同时执行的，只是把时间分成若干端，使多个进程快速交替的执行。 </p>
<p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281837097.png" alt="1636612367348"></p>
<h3 id="1-4-2，并行"><a href="#1-4-2，并行" class="headerlink" title="1.4.2，并行"></a>1.4.2，并行</h3><p>指在同一时刻，有多条指令在多核处理器上同时执行。 </p>
<p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281837145.png" alt="1636612446611"></p>
<p>ABC都是同时执行（微观、宏观）</p>
<h2 id="1-5，并发编程和并行编程"><a href="#1-5，并发编程和并行编程" class="headerlink" title="1.5，并发编程和并行编程"></a>1.5，并发编程和并行编程</h2><p>在CPU比较繁忙，资源不足的时候（开启了很多进程），操作系统只为一个含有多线程的进程分配仅有的CPU资源，这些线程就会为自己尽量多抢时间片，这就是通过多线程实现并发，线程之间会竞争CPU资源争取执行机会。 </p>
<p>在CPU资源比较充足的时候，一个进程内的多线程，可以被分配到不同的CPU资源，这就是通过多线程实现并行。</p>
<h1 id="2，线程的创建"><a href="#2，线程的创建" class="headerlink" title="2，线程的创建"></a>2，线程的创建</h1><h2 id="2-1，Thread-类介绍"><a href="#2-1，Thread-类介绍" class="headerlink" title="2.1，Thread 类介绍"></a>2.1，Thread 类介绍</h2><p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281837849.png" alt="1636612834770"></p>
<h3 id="相关属性"><a href="#相关属性" class="headerlink" title="相关属性"></a>相关属性</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">javastatic <span class="type">int</span> MAX_PRIORITY  线程可以具有的最高优先级。 </span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> MIN_PRIORITY 线程可以具有的最低优先级。 </span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> NORM_PRIORITY 分配给线程的默认优先级。  [默认]</span><br></pre></td></tr></table></figure>

<h3 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Thread() 分配新的 Thread 对象。 </span><br><span class="line">Thread(Runnable target) 分配新的 Thread 对象。 </span><br><span class="line">Thread(Runnable target, String name) 分配新的 Thread 对象。 </span><br><span class="line">Thread(String name) 分配新的 Thread 对象。 </span><br></pre></td></tr></table></figure>

<h2 id="2-2，继承Thread类"><a href="#2-2，继承Thread类" class="headerlink" title="2.2，继承Thread类"></a>2.2，继承Thread类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread01;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-11 14:46、</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 创建线程的第一种方式</span></span><br><span class="line"><span class="comment"> * 创建类并继承Thread类</span></span><br><span class="line"><span class="comment"> * 重写里面的run方法</span></span><br><span class="line"><span class="comment"> * 创建对象</span></span><br><span class="line"><span class="comment"> * 调用start()方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test01Thread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建线程对象</span></span><br><span class="line">        MyThread myThread=<span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line"><span class="comment">//        myThread.run();//只是方法的调用</span></span><br><span class="line">        <span class="comment">//启动</span></span><br><span class="line">        myThread.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;我是主线程&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span>  <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=<span class="number">100</span> ; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">500</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3，实现Runnable接口"><a href="#2-3，实现Runnable接口" class="headerlink" title="2.3，实现Runnable接口"></a>2.3，实现Runnable接口</h2><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>创建任务类实现Runnable接口</p>
<p>实现Runnable接口里面的run方法</p>
<p>创建任务对象</p>
<p>创建线程对象并放到任务对象</p>
<p>启动线程执行</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread01;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-11 14:53</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 创建线程的第二种方式</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 创建任务类实现Runnable接口</span></span><br><span class="line"><span class="comment"> * 实现Runnable接口里面的run方法</span></span><br><span class="line"><span class="comment"> * 创建任务对象</span></span><br><span class="line"><span class="comment"> * 创建线程对象并放到任务对象</span></span><br><span class="line"><span class="comment"> * 启动线程执行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test02Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建任务对象</span></span><br><span class="line">        MyTask myTask=<span class="keyword">new</span> <span class="title class_">MyTask</span>();</span><br><span class="line">        <span class="comment">//创建线程对象</span></span><br><span class="line">        Thread thread=<span class="keyword">new</span> <span class="title class_">Thread</span>(myTask);</span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        thread.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;我是主线程&quot;</span>+Thread.currentThread().getName());</span><br><span class="line"></span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">MyTask</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=<span class="number">100</span> ; i++) &#123;</span><br><span class="line">            System.out.println(i+<span class="string">&quot;  &quot;</span>+Thread.currentThread().getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4，使用匿名内部类"><a href="#2-4，使用匿名内部类" class="headerlink" title="2.4，使用匿名内部类"></a>2.4，使用匿名内部类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread01;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-11 14:58</span></span><br><span class="line"><span class="comment"> * 使用匿名内部类实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test03Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=<span class="number">100</span> ; i++) &#123;</span><br><span class="line">                    System.out.println(i+<span class="string">&quot;---&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=<span class="number">100</span> ; i++) &#123;</span><br><span class="line">                    System.out.println(i+<span class="string">&quot;---&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;我是主线程&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4，使用Lambad"><a href="#2-4，使用Lambad" class="headerlink" title="2.4，使用Lambad"></a>2.4，使用Lambad</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread01;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-11 14:58</span></span><br><span class="line"><span class="comment"> * 使用 lambad 类实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test04Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">           <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=<span class="number">100</span> ; i++) &#123;</span><br><span class="line">               System.out.println(i+<span class="string">&quot;---&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=<span class="number">100</span> ; i++) &#123;</span><br><span class="line">                System.out.println(i+<span class="string">&quot;---&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        System.out.println(<span class="string">&quot;我是主线程&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3，线程的生命周期"><a href="#3，线程的生命周期" class="headerlink" title="3，线程的生命周期"></a>3，线程的生命周期</h1><p>生命周期：对象从创建到销毁的整个过程</p>
<h2 id="3-1，线程的生命周期"><a href="#3-1，线程的生命周期" class="headerlink" title="3.1，线程的生命周期"></a>3.1，线程的生命周期</h2><p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281837283.png" alt="1636616569416"></p>
<h3 id="新建状态（New）"><a href="#新建状态（New）" class="headerlink" title="新建状态（New）"></a><strong>新建状态（New）</strong></h3><p>用new关键字和Thread类或其子类建立一个线程对象后，该线程对象就处于新建状态。处于新建状态的线程有自己的内存空间，通过调用start方法进入就绪状态（Runnable）</p>
<h3 id="就绪状态（Runnable）"><a href="#就绪状态（Runnable）" class="headerlink" title="就绪状态（Runnable）"></a><strong>就绪状态（Runnable）</strong></h3><p>处于就绪状态的线程已经具备了运行条件（也就是具备了在CPU上运行的资格），但还没有分配到CPU的执行权，处于“线程就绪队列”，等待系统为其分配CPU。 就绪状态并不是执行状态，当系统选定一个等待执行的Thread对象后，它就会进入执行状态。 一旦获得CPU，线程就进入运行状态并自动调用自己的run方法。</p>
<h3 id="运行状态（Running）"><a href="#运行状态（Running）" class="headerlink" title="运行状态（Running）"></a><strong>运行状态（Running）</strong></h3><p>处于就绪状态的线程，如果获得了CPU的调度，就会从就绪状态变为运行状态，执行run()方法中的任务。</p>
<p>运行状态的线程最为复杂，它可以变为阻塞状态、就绪状态和死亡状态。</p>
<p>如果该线程失去了CPU资源，就会又从运行状态变为就绪状态，重新等待系统分配资源。也可以对在运行状态的线程调用yield()方法，它就会让出CPU资源，再次变为就绪状态</p>
<h3 id="阻塞状态（Blocked）"><a href="#阻塞状态（Blocked）" class="headerlink" title="阻塞状态（Blocked）"></a><strong>阻塞状态（Blocked）</strong></h3><p>处于运行状态中的线程由于某种原因，暂时放弃对CPU的使用权，停止执行，此时进入阻塞状态，直到其进入到就绪状态，才有机会再次被CPU调用以进入到运行状态。</p>
<p>根据阻塞产生的原因不同，阻塞状态又可以分为三种：</p>
<ol>
<li><p>等待阻塞：运行状态中的线程执行wait()方法，使本线程进入到等待阻塞状态。</p>
</li>
<li><p>同步阻塞：线程在获取synchronized同步锁失败(因为锁被其它线程所占用)，它会进入同步阻塞状态。</p>
</li>
<li><p>其他阻塞：通过调用线程的sleep()或join()或发出了I&#x2F;O请求时，线程会进入到阻塞状态。当sleep()状态超时、join()等待线程终止或者超时、或者I&#x2F;O处理完毕时，线程重新转入就绪状态。</p>
</li>
</ol>
<h3 id="死亡状态（Dead）"><a href="#死亡状态（Dead）" class="headerlink" title="死亡状态（Dead）"></a><strong>死亡状态（Dead）</strong></h3><p>线程在run()方法执行完了或者因异常退出了run()方法，该线程结束生命周期。此外，如果线程执行了interrupt()或stop()方法，那么它也会以异常退出的方式进入死亡状态。</p>
<h2 id="3-2，-线程状态的控制"><a href="#3-2，-线程状态的控制" class="headerlink" title="3.2， 线程状态的控制"></a>3.2， <strong>线程状态的控制</strong></h2><p>Java提供了一些便捷的方法用于会线程状态的控制。线程状态的控制Java给我们提供了很多方法，但是有些已经标注为过时的，我们应该尽可能的避免使用它们，此处我们重点关注start()、interrupt()、join()、sleep()、yield()等直接控制方法，和setDaemon()、setPriority()等间接控制方法。</p>
<h3 id="线程的优先级"><a href="#线程的优先级" class="headerlink" title="线程的优先级"></a>线程的优先级</h3><p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281837942.png" alt="1636616975807"></p>
<p>设置方式通过Thread对象的<strong>setPriority(int newPriority)</strong></p>
<p>注意点：优先给最小只能是1  最大只能是10</p>
<p>​		如果线程A的优先级是10   线程B的优先级是1 并不是A一定优级B先执行 只是整体趋势为A先执行</p>
<h3 id="线程睡眠"><a href="#线程睡眠" class="headerlink" title="线程睡眠"></a><strong>线程睡眠</strong></h3><p>如果我们需要让当前正在执行的线程暂停一段时间，并进入阻塞状态，指定时间之后，解除阻塞状态，进入就绪状态，则可以通过调用Thread的sleep方法，从API查阅可以看到sleep方法有两种重载的形式，但是使用方式一模一样。</p>
<p>注意点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Thread.sleep(毫秒) 写在哪个线程里面就是睡眠哪个线程 如果时间结之后线程会自动进入就绪状态再次去争抢CPU资源</span><br></pre></td></tr></table></figure>

<h3 id="线程让步"><a href="#线程让步" class="headerlink" title="线程让步"></a><strong>线程让步</strong></h3><p>yield()方法和sleep()方法有点相似，它也是Thread类提供的一个静态的方法，它也可以让当前正在执行的线程暂停，让出CPU资源给其它的线程。但是和sleep()方法不同的是，它不会进入到阻塞状态，而是进入到就绪状态。yield()方法只是让当前线程暂停一下，重新进入就绪的线程池中，让系统的线程调度器重新调度器重新调度一次，完全可能出现这样的情况：当某个线程调用yield()方法之后，线程调度器又将其调度出来重新进入到运行状态执行。</p>
<p>实际上，当某个线程调用了yield()方法暂停之后，优先级与当前线程相同，或者优先级比当前线程更高的就绪状态的线程更有可能获得执行的机会，当然，只是有可能，因为我们不可能精确的干涉CPU调度线程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread02;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-11 15:51</span></span><br><span class="line"><span class="comment"> * 优先级的设置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test03Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Thread t1=<span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyTask3</span>());</span><br><span class="line">        Thread t2=<span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyTask3</span>());</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;主线程结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">MyTask3</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=<span class="number">2</span> ; i++) &#123;</span><br><span class="line">            System.out.println(i+<span class="string">&quot; &quot;</span>+Thread.currentThread().getName());</span><br><span class="line">            Thread.<span class="keyword">yield</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="线程的合并"><a href="#线程的合并" class="headerlink" title="线程的合并"></a>线程的合并</h3><p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281837549.png" alt="1636618218648"></p>
<p>A线程对象 里面join B线程  那么A线程想要执行完成，必须等待B线程执行完</p>
<p>线程的合并就是：线程A在运行期间，可以调用线程B的join()方法，这样线程A就必须等待线程B执行完毕后，才能继续执行。</p>
<p>应用场景是当一个线程必须等待另一个线程执行完毕才能执行时，Thread类提供了join方法来完成这个功能，注意，它不是静态方法。</p>
<p>注意点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj.join()方法写在哪个线程里面就是把obj这个线程加到这个线程里面</span><br></pre></td></tr></table></figure>

<h3 id="守护线程"><a href="#守护线程" class="headerlink" title="守护线程"></a><strong>守护线程</strong></h3><p>守护线程与普通线程写法上基本没啥区别，调用线程对象的方法setDaemon(true)，就可以把该线程标记为守护线程或用户线程。</p>
<p>当正在运行的线程都是守护线程时，Java虚拟机将退出。setDaemon(true)方法必须在启动线程前调用，否则抛出IllegalThreadStateException异常。   </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread02;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-11 16:16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test05Daemon</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        Thread t1=<span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyTask5</span>());</span><br><span class="line">        <span class="comment">//设置当前线程为守护线程</span></span><br><span class="line">        t1.setDaemon(<span class="literal">true</span>);<span class="comment">//这个方法必须是start之前调用</span></span><br><span class="line">        t1.start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=<span class="number">5</span> ; i++) &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;主线程睡眠&quot;</span>+i+<span class="string">&quot;秒&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是主线程&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">MyTask5</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;我是守护者&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">500</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意点：</p>
<p><strong>JVM里面的垃圾回收线程其它就是一个守护线程</strong></p>
<h1 id="4，线程同步"><a href="#4，线程同步" class="headerlink" title="4，线程同步"></a>4，线程同步</h1><h2 id="4-1-同步代码块详解"><a href="#4-1-同步代码块详解" class="headerlink" title="4.1 同步代码块详解"></a>4.1 <strong>同步代码块</strong>详解</h2><p>“非线程安全”其实就是在多个线程对同一个对象中的实例变量进行并发访问时发生，产生的后果就是“脏读”，也就是取到的数据其实是被更改过的的结果。在Java中，关键字synchronized可以保证在同一个时刻，只有一个线程可以执行某个方法或者某个代码块（主要是对方法或者代码块中存在共享数据的操作）。</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">synchroinzed(监视器)&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">注意点：监视器必须是同一个对象</span><br></pre></td></tr></table></figure>

<h2 id="4-2同步方法-非静态"><a href="#4-2同步方法-非静态" class="headerlink" title="4.2同步方法[非静态]"></a>4.2同步方法[非静态]</h2><h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public void synchronized method()&#123;</span><br><span class="line">    //同步代码</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">如果同步方法为非静态的方法</span><br><span class="line">那么上面的代码等价于</span><br><span class="line"></span><br><span class="line">public void  method()&#123;</span><br><span class="line">    synchroinzed(this)&#123;</span><br><span class="line">        //同步代码</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-3监视器可以为字节码文件"><a href="#4-3监视器可以为字节码文件" class="headerlink" title="4.3监视器可以为字节码文件"></a>4.3监视器可以为字节码文件</h2><p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281837964.png" alt="1636622034442"></p>
<p>因为xxxx.classs为java代码编译后的字节码文件 ，在内存里面只会存放一份</p>
<h2 id="4-4同步方法-静态方法"><a href="#4-4同步方法-静态方法" class="headerlink" title="4.4同步方法[静态方法]"></a>4.4同步方法[静态方法]</h2><h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class A&#123;</span><br><span class="line">    public synchroinzed static void m1()&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码等价于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class A&#123;</span><br><span class="line">     public  static void m1()&#123;</span><br><span class="line">     	   synchroinzed(A.class)&#123;</span><br><span class="line">               </span><br><span class="line">     	   &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-5-synchronized总结"><a href="#4-5-synchronized总结" class="headerlink" title="4.5,synchronized总结"></a>4.5,synchronized总结</h2><p>1、只能同步方法和代码块，而不能同步变量和类。</p>
<p>2、只有共享资源的读写访问才需要同步，如果不是共享资源，根本没有同步的必要。</p>
<p>3、编写线程安全的代码会使系统的总体效率会降低，并且容易发生<strong>死锁</strong>的情况。</p>
<p>4、无论是同步代码块还是同步方法，必须获得对象锁才能够进入同步代码块或同步方法进行操作。</p>
<p>5、如果是非静态同步方法，对象锁为方法所在的对象；如果是静态同步方法，对象锁为方法所在的类（唯一）。</p>
<p>6、如果两个线程要执行一个类中的静态同步方法或非静态同步方法，那么一次只能有一个线程能够执行方法，另一个需要等待，直到锁被释放。也就是说，如果一个线程在对象上获得一个锁，就没有任何其它线程可以进入（该对象的）类中的任何一个同步方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">释放锁的时间：当代码块里面的所有代码全部执行完成之后会自动释放锁</span><br><span class="line">当代码块里面的代码出现异常，也会自己动释放锁</span><br></pre></td></tr></table></figure>

<p><strong>总结</strong>2：一个线程取得了同步锁，那么在什么时候才会释放掉呢？</p>
<p><strong>总结3：</strong>synchronized的可重入性</p>
<p>在使用synchronized时，当一个线程得到一个对象锁后（只要该线程还没有释放这个对象锁），再次请求此对象锁时是可以再次得到该对象的锁的（例如：同步方法可以调用同一个对象的另一个同步方法）。:’yes’;font-、</p>
<p><strong>总结4：****同步不具有继承性，也就是同步不可以继承</strong></p>
<h2 id="4-6，死锁"><a href="#4-6，死锁" class="headerlink" title="4.6，死锁"></a>4.6，死锁</h2><p>为什么会有死锁</p>
<p>就是因为同步使用当，产生多线程之间相互等待的问题</p>
<p>讲死锁是原因是让大家在开发中去避免死锁的问题</p>
<h3 id="原理图"><a href="#原理图" class="headerlink" title="原理图"></a>原理图</h3><p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281837784.png" alt="1636679769486"></p>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread04;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-12 9:09</span></span><br><span class="line"><span class="comment"> * 死锁的例子</span></span><br><span class="line"><span class="comment"> * 实现方式</span></span><br><span class="line"><span class="comment"> * 启动A B两个线程</span></span><br><span class="line"><span class="comment"> * 创建objA和objB两个监视器</span></span><br><span class="line"><span class="comment"> * 启动线程AB之后让A去抢objA的锁 再去抢objB的锁</span></span><br><span class="line"><span class="comment"> *        让B去抢objB的锁 再去抢objA的锁</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadLock</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建两个监视器对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Object objA=<span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Object objB=<span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建并启动线程A</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="comment">//A去抢objA的锁 再去抢objB的锁</span></span><br><span class="line">                <span class="keyword">synchronized</span> (objA)&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot; 获得了objA的锁&quot;</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot; 睡眠结束再去尝试得到objB的锁&quot;</span>);</span><br><span class="line">                    <span class="keyword">synchronized</span> (objB)&#123;</span><br><span class="line">                        System.out.println(Thread.currentThread().getName()+<span class="string">&quot; 获得了objB的锁&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;线程A&quot;</span>).start();</span><br><span class="line">        <span class="comment">//创建并启动线程B</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="comment">//B去抢objB的锁 再去抢objA的锁</span></span><br><span class="line">                <span class="keyword">synchronized</span> (objB)&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot; 获得了objB的锁&quot;</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot; 睡眠结束再去尝试得到objA的锁&quot;</span>);</span><br><span class="line">                    <span class="keyword">synchronized</span> (objA)&#123;</span><br><span class="line">                        System.out.println(Thread.currentThread().getName()+<span class="string">&quot; 获得了objA的锁&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;线程B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-7，作业【过山洞】"><a href="#4-7，作业【过山洞】" class="headerlink" title="4.7，作业【过山洞】"></a>4.7，作业【过山洞】</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread05;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-12 9:40</span></span><br><span class="line"><span class="comment"> * 2.编写多线程程序，模拟多个人通过一个山洞的模拟。这个山洞每次只能通过一个人，</span></span><br><span class="line"><span class="comment"> * 每个人通过山洞的时间为5秒，有10个人同时准备过此山洞，显示每次通过山洞人的姓名和顺序。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestCave</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//声明山洞</span></span><br><span class="line">        Cave cave=<span class="keyword">new</span> <span class="title class_">Cave</span>();</span><br><span class="line">        <span class="comment">//循环启动10个线程 使用线程名做为人的名字</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=<span class="number">10</span> ; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">CaveRunnable</span>(cave),<span class="string">&quot;小明&quot;</span>+i).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建一个山洞</span></span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">Cave</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> SimpleDateFormat sdf=<span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 过山洞</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">pass</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【&quot;</span>+Thread.currentThread().getName()+<span class="string">&quot;】 进入山洞 进入时间:&quot;</span>+sdf.format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=<span class="number">5</span> ; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;【&quot;</span>+Thread.currentThread().getName()+<span class="string">&quot;】 走啊，走啊，走啊:&quot;</span>+i+<span class="string">&quot; 秒&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建任务类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CaveRunnable</span> <span class="keyword">implements</span>  <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明共享资源</span></span><br><span class="line">    <span class="keyword">private</span> Cave cave;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CaveRunnable</span><span class="params">(Cave cave)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cave = cave;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        cave.pass();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="5，线程通讯"><a href="#5，线程通讯" class="headerlink" title="5，线程通讯"></a>5，线程通讯</h1><h2 id="5-1-等待唤醒方法"><a href="#5-1-等待唤醒方法" class="headerlink" title="5.1 等待唤醒方法"></a>5.1 <strong>等待唤醒</strong>方法</h2><p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281836275.png" alt="1636682921274"></p>
<p>wait() ：等待，将正在执行的线程释放其执行资格和执行权，进入阻塞状态，并存储到线程池中。</p>
<p>notify()：唤醒，唤醒线程池中 wait()的线程，一次唤醒一个，而且是任意的。</p>
<p>notifyAll()：唤醒全部，可以将线程池中的所有 wait() 线程都唤醒。</p>
<p>其实，所谓唤醒的意思就是让线程池中的线程具备执行资格。必须注意的是，这些方法都是在</p>
<h2 id="5-2，sleep-和-wait-方法的区别"><a href="#5-2，sleep-和-wait-方法的区别" class="headerlink" title="5.2，sleep()和 wait()方法的区别"></a>5.2，sleep()和 wait()方法的区别</h2><p>1、 sleep不要求同步；wait必须先同步。</p>
<p>2、 sleep在休眠的时间内，不能唤醒；wait在等待的时间内，能唤醒。</p>
<p>3、 如果都在同步代码块里面sleep不释放锁（如果有锁），不释放 CPU 使用权；wait释放锁，释放 CPU 使用权。</p>
<h2 id="5-3，单生产者和单消费者"><a href="#5-3，单生产者和单消费者" class="headerlink" title="5.3，单生产者和单消费者"></a>5.3，单生产者和单消费者</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread06.producecunsume01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.c4rich.thread02.T;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-12 10:00</span></span><br><span class="line"><span class="comment"> * 生产者消费者模型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestProduceAndConsume</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//创建篮子</span></span><br><span class="line">        ProductStack stack=<span class="keyword">new</span> <span class="title class_">ProductStack</span>();</span><br><span class="line">        <span class="comment">//创建生产者任务</span></span><br><span class="line">        ProduceRunnable produceRunnable=<span class="keyword">new</span> <span class="title class_">ProduceRunnable</span>(stack);</span><br><span class="line">        <span class="comment">//创建消费者任务</span></span><br><span class="line">        ConsumeRunnable consumeRunnable=<span class="keyword">new</span> <span class="title class_">ConsumeRunnable</span>(stack);</span><br><span class="line">        <span class="comment">//创建线程</span></span><br><span class="line">        Thread p1=<span class="keyword">new</span> <span class="title class_">Thread</span>(produceRunnable,<span class="string">&quot;生产者&quot;</span>);</span><br><span class="line">        Thread c1=<span class="keyword">new</span> <span class="title class_">Thread</span>(consumeRunnable,<span class="string">&quot;消费者&quot;</span>);</span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        p1.start();</span><br><span class="line">        c1.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//商品类</span></span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="comment">// 商品名称</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// 商品颜色</span></span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getColor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setColor</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.color+<span class="string">&quot;的&quot;</span>+<span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//篮子类</span></span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">ProductStack</span> &#123;</span><br><span class="line">    <span class="comment">//默认篮子里面只能放一个商品</span></span><br><span class="line">    <span class="keyword">private</span>  Product product=<span class="keyword">new</span> <span class="title class_">Product</span>();</span><br><span class="line">    <span class="comment">//声明一个属性标记篮子里面有没有商品</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> flag=<span class="literal">false</span>;<span class="comment">//默认没有商品</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生产的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">(String name,String color)</span>&#123;</span><br><span class="line">        <span class="comment">//判断篮子里面有没有商品</span></span><br><span class="line">        <span class="keyword">if</span>(flag==<span class="literal">true</span>) &#123;<span class="comment">//说明有商品  就不生产 等消费者消费之后再生产</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.如果没有商品，则生产。</span></span><br><span class="line">        product.setName(name);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        product.setColor(color);</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;生产了&quot;</span>+product);</span><br><span class="line">        <span class="comment">//3.说明生产完成  把篮子里面的状态变成true</span></span><br><span class="line">        <span class="built_in">this</span>.flag=<span class="literal">true</span>;<span class="comment">//变成有商品</span></span><br><span class="line">        <span class="comment">//4.通知消费者可以消费了</span></span><br><span class="line">        <span class="built_in">this</span>.notify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 消费的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//如果篮子里面有商品就可以消费 没有就等着</span></span><br><span class="line">        <span class="keyword">if</span>(flag==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//消费</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot; 消费了:&quot;</span>+product);</span><br><span class="line">        <span class="comment">//把篮子的状态变成false</span></span><br><span class="line">        <span class="built_in">this</span>.flag=<span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//通知生产者继续生产</span></span><br><span class="line">        <span class="built_in">this</span>.notify();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//生产者线程类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProduceRunnable</span> <span class="keyword">implements</span>  <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ProductStack stack;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProduceRunnable</span><span class="params">(ProductStack stack)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stack = stack;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                stack.produce(<span class="string">&quot;馒头&quot;</span>+i,<span class="string">&quot;白色&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                stack.produce(<span class="string">&quot;玉米棒&quot;</span>+i,<span class="string">&quot;黄色&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//消费者线程类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConsumeRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ProductStack stack;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConsumeRunnable</span><span class="params">(ProductStack stack)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stack = stack;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="built_in">this</span>.stack.consume();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-4，多生产者和多消费者"><a href="#5-4，多生产者和多消费者" class="headerlink" title="5.4，多生产者和多消费者"></a>5.4，多生产者和多消费者</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread06.producecunsume02;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-12 10:00</span></span><br><span class="line"><span class="comment"> * 生产者消费者模型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestProduceAndConsume</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//创建篮子</span></span><br><span class="line">        ProductStack stack=<span class="keyword">new</span> <span class="title class_">ProductStack</span>();</span><br><span class="line">        <span class="comment">//创建生产者任务</span></span><br><span class="line">        ProduceRunnable produceRunnable=<span class="keyword">new</span> <span class="title class_">ProduceRunnable</span>(stack);</span><br><span class="line">        <span class="comment">//创建消费者任务</span></span><br><span class="line">        ConsumeRunnable consumeRunnable=<span class="keyword">new</span> <span class="title class_">ConsumeRunnable</span>(stack);</span><br><span class="line">        <span class="comment">//创建线程</span></span><br><span class="line">        Thread p1=<span class="keyword">new</span> <span class="title class_">Thread</span>(produceRunnable,<span class="string">&quot;生产者A&quot;</span>);</span><br><span class="line">        Thread p2=<span class="keyword">new</span> <span class="title class_">Thread</span>(produceRunnable,<span class="string">&quot;生产者B&quot;</span>);</span><br><span class="line">        Thread c1=<span class="keyword">new</span> <span class="title class_">Thread</span>(consumeRunnable,<span class="string">&quot;消费者A&quot;</span>);</span><br><span class="line">        Thread c2=<span class="keyword">new</span> <span class="title class_">Thread</span>(consumeRunnable,<span class="string">&quot;消费者B&quot;</span>);</span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        p1.start();</span><br><span class="line">        p2.start();</span><br><span class="line">        c1.start();</span><br><span class="line">        c2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//商品类</span></span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="comment">// 商品名称</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// 商品颜色</span></span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getColor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setColor</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.color+<span class="string">&quot;的&quot;</span>+<span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//篮子类</span></span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">ProductStack</span> &#123;</span><br><span class="line">    <span class="comment">//默认篮子里面只能放一个商品</span></span><br><span class="line">    <span class="keyword">private</span>  Product product=<span class="keyword">new</span> <span class="title class_">Product</span>();</span><br><span class="line">    <span class="comment">//声明一个属性标记篮子里面有没有商品</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> flag=<span class="literal">false</span>;<span class="comment">//默认没有商品</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生产的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">(String name,String color)</span>&#123;</span><br><span class="line">        <span class="comment">//判断篮子里面有没有商品</span></span><br><span class="line">        <span class="keyword">while</span> (flag==<span class="literal">true</span>) &#123;<span class="comment">//说明有商品  就不生产 等消费者消费之后再生产</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.如果没有商品，则生产。</span></span><br><span class="line">        product.setName(name);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        product.setColor(color);</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;生产了&quot;</span>+product);</span><br><span class="line">        <span class="comment">//3.说明生产完成  把篮子里面的状态变成true</span></span><br><span class="line">        <span class="built_in">this</span>.flag=<span class="literal">true</span>;<span class="comment">//变成有商品</span></span><br><span class="line">        <span class="comment">//4.通知消费者可以消费了</span></span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 消费的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//如果篮子里面有商品就可以消费 没有就等着</span></span><br><span class="line">        <span class="keyword">while</span> (flag==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//消费</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot; 消费了:&quot;</span>+product);</span><br><span class="line">        <span class="comment">//把篮子的状态变成false</span></span><br><span class="line">        <span class="built_in">this</span>.flag=<span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//通知生产者继续生产</span></span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//生产者线程类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProduceRunnable</span> <span class="keyword">implements</span>  <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ProductStack stack;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProduceRunnable</span><span class="params">(ProductStack stack)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stack = stack;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">if</span>(i%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                stack.produce(<span class="string">&quot;馒头&quot;</span>,<span class="string">&quot;白色&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                stack.produce(<span class="string">&quot;玉米棒&quot;</span>,<span class="string">&quot;黄色&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//消费者线程类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConsumeRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ProductStack stack;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConsumeRunnable</span><span class="params">(ProductStack stack)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stack = stack;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="built_in">this</span>.stack.consume();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="6-Lock锁"><a href="#6-Lock锁" class="headerlink" title="6,Lock锁"></a>6,<strong>Lock</strong>锁</h1><p>Lock锁是JDK1.5之提供的一个接口，</p>
<h2 id="6-1，-synchronized的缺陷"><a href="#6-1，-synchronized的缺陷" class="headerlink" title="6.1， synchronized的缺陷"></a>6.1， synchronized的缺陷</h2><p>如果一个代码块被synchronized修饰了，当一个线程获取了对应的锁，并执行该代码块时，其它线程便只能一直等待，等待获取锁的线程释放锁，而这里获取锁的线程释放锁会有三种情况：</p>
<p>1）获取锁的线程执行完了该代码块，然后线程释放对锁的占有。</p>
<p>2）线程执行发生了异常，此时JVM会让线程自动释放锁。</p>
<p>3）在多生产者多消费者问题中，我们通过while判断和notifyAll()全唤醒方案来解决问题，但是notifyAll()同时也带来了弊端，它要唤醒所有的被等待的线程，意味着既唤醒了对方，也唤醒了本方，在唤醒本方线程后还要不断判断标记，就降低了程序的效率。如果我们希望只唤醒对方的线程，而不唤醒本方线程，那么我们可以使用JDK5以后提供的Lock锁。</p>
<p>另外，虽然我们可以理解同步代码块和同步方法的锁对象问题，但是我们并没有直接看到在哪里加上了锁，在哪里释放了锁，因为synchronized对于锁的操作是隐式的。</p>
<p>同步代码块的加锁和释放锁位置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public void method() &#123;</span><br><span class="line">	synchronized (this) &#123; // 加锁位置</span><br><span class="line">		// 需要被同步的代码</span><br><span class="line">	&#125; // 释放锁位置</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同步方法的加锁和释放锁位置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public synchronized void method() &#123; // 加锁位置</span><br><span class="line">	// 需要被同步的代码</span><br><span class="line">&#125; // 释放锁位置</span><br></pre></td></tr></table></figure>

<p>为了更清晰的表达如何加锁和释放锁，我们可以使用JDK5以后提供的Lock锁。Lock将同步和锁封装成了对象，并将加锁和释放锁变为了显示动作，这个是synchronized无法办到的。总之，Lock实现提供了比使用synchronized方法和代码块更广泛的锁定操作。</p>
<p>　总结一下，也就是说Lock提供了比synchronized更多的功能。但是要注意以下几点：</p>
<p>1） Lock不是Java语言内置的，synchronized是Java语言的关键字，因此是内置特性；Lock是一个类，通过这个类可以实现同步访问。</p>
<p>2） synchronized不需要用户去手动释放锁，当synchronized方法或者synchronized代码块执行	完之后，系统会自动让线程释放对锁的占用；而Lock则必须要用户去手动释放锁，如果没有主动释放锁，就有可能导致出现死锁现象。</p>
<p>总结：synchronized不用管加锁和释放  lock要手动加锁手动释放</p>
<h2 id="6-2，Lock接口详解"><a href="#6-2，Lock接口详解" class="headerlink" title="6.2，Lock接口详解"></a>6.2，Lock接口详解</h2><p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281836658.png" alt="1636687749296"></p>
<h3 id="相关重点方法"><a href="#相关重点方法" class="headerlink" title="相关重点方法"></a>相关重点方法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">void lock() 获取锁。 </span><br><span class="line">void unlock() 释放锁。 </span><br><span class="line">Condition newCondition() 返回绑定到此 Lock 实例的新 监视器的实例 </span><br></pre></td></tr></table></figure>

<h3 id="Lock锁的使用语法"><a href="#Lock锁的使用语法" class="headerlink" title="Lock锁的使用语法"></a>Lock锁的使用语法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> ...;</span><br><span class="line">lock.lock(); <span class="comment">// 获取锁</span></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	<span class="comment">// 需要处理任务代码</span></span><br><span class="line">&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line"><span class="comment">// 处理异常 </span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">lock.unlock(); <span class="comment">// 释放锁</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：使用Lock必须在try{}catch{}块中进行，并且将释放锁的操作放在finally块中进行，以保证锁一定被被释放，防止死锁的发生</p>
<h2 id="6-3，使用Lock去改生产者和消费者"><a href="#6-3，使用Lock去改生产者和消费者" class="headerlink" title="6.3，使用Lock去改生产者和消费者"></a>6.3，使用Lock去改生产者和消费者</h2><p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281836687.png" alt="1636688929978"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread07;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-12 10:00</span></span><br><span class="line"><span class="comment"> * 生产者消费者模型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestProduceAndConsume</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//创建篮子</span></span><br><span class="line">        ProductStack stack=<span class="keyword">new</span> <span class="title class_">ProductStack</span>();</span><br><span class="line">        <span class="comment">//创建生产者任务</span></span><br><span class="line">        ProduceRunnable produceRunnable=<span class="keyword">new</span> <span class="title class_">ProduceRunnable</span>(stack);</span><br><span class="line">        <span class="comment">//创建消费者任务</span></span><br><span class="line">        ConsumeRunnable consumeRunnable=<span class="keyword">new</span> <span class="title class_">ConsumeRunnable</span>(stack);</span><br><span class="line">        <span class="comment">//创建线程</span></span><br><span class="line">        Thread p1=<span class="keyword">new</span> <span class="title class_">Thread</span>(produceRunnable,<span class="string">&quot;生产者A&quot;</span>);</span><br><span class="line">        Thread p2=<span class="keyword">new</span> <span class="title class_">Thread</span>(produceRunnable,<span class="string">&quot;生产者B&quot;</span>);</span><br><span class="line">        Thread c1=<span class="keyword">new</span> <span class="title class_">Thread</span>(consumeRunnable,<span class="string">&quot;消费者A&quot;</span>);</span><br><span class="line">        Thread c2=<span class="keyword">new</span> <span class="title class_">Thread</span>(consumeRunnable,<span class="string">&quot;消费者B&quot;</span>);</span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        p1.start();</span><br><span class="line">        p2.start();</span><br><span class="line">        c1.start();</span><br><span class="line">        c2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//商品类</span></span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="comment">// 商品名称</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// 商品颜色</span></span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getColor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setColor</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.color+<span class="string">&quot;的&quot;</span>+<span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//篮子类</span></span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">ProductStack</span> &#123;</span><br><span class="line">    <span class="comment">//默认篮子里面只能放一个商品</span></span><br><span class="line">    <span class="keyword">private</span>  Product product=<span class="keyword">new</span> <span class="title class_">Product</span>();</span><br><span class="line">    <span class="comment">//声明一个属性标记篮子里面有没有商品</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> flag=<span class="literal">false</span>;<span class="comment">//默认没有商品</span></span><br><span class="line">    <span class="comment">//声明一个锁对象</span></span><br><span class="line">    <span class="keyword">private</span> Lock lock=<span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="comment">//声明一个生产者的监视器</span></span><br><span class="line">    <span class="type">Condition</span> <span class="variable">condition_pro</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="comment">//声明一个消费者的监视器</span></span><br><span class="line">    <span class="type">Condition</span> <span class="variable">condition_cus</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生产的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">(String name,String color)</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//判断篮子里面有没有商品</span></span><br><span class="line">            <span class="keyword">while</span> (flag==<span class="literal">true</span>) &#123;<span class="comment">//说明有商品  就不生产 等消费者消费之后再生产</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    condition_pro.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 2.如果没有商品，则生产。</span></span><br><span class="line">            product.setName(name);</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            product.setColor(color);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;生产了&quot;</span>+product);</span><br><span class="line">            <span class="comment">//3.说明生产完成  把篮子里面的状态变成true</span></span><br><span class="line">            <span class="built_in">this</span>.flag=<span class="literal">true</span>;<span class="comment">//变成有商品</span></span><br><span class="line">            <span class="comment">//4.通知消费者可以消费了</span></span><br><span class="line">            condition_cus.signalAll();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 消费的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">()</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//如果篮子里面有商品就可以消费 没有就等着</span></span><br><span class="line">            <span class="keyword">while</span> (flag==<span class="literal">false</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    condition_cus.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//消费</span></span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot; 消费了:&quot;</span>+product);</span><br><span class="line">            <span class="comment">//把篮子的状态变成false</span></span><br><span class="line">            <span class="built_in">this</span>.flag=<span class="literal">false</span>;</span><br><span class="line">            <span class="comment">//通知生产者继续生产</span></span><br><span class="line">            condition_pro.signalAll();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//生产者线程类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProduceRunnable</span> <span class="keyword">implements</span>  <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ProductStack stack;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProduceRunnable</span><span class="params">(ProductStack stack)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stack = stack;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">if</span>(i%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                stack.produce(<span class="string">&quot;馒头&quot;</span>,<span class="string">&quot;白色&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                stack.produce(<span class="string">&quot;玉米棒&quot;</span>,<span class="string">&quot;黄色&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//消费者线程类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConsumeRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ProductStack stack;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConsumeRunnable</span><span class="params">(ProductStack stack)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stack = stack;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="built_in">this</span>.stack.consume();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="7，并发编程工具类"><a href="#7，并发编程工具类" class="headerlink" title="7，并发编程工具类"></a>7，并发编程工具类</h1><h2 id="7-1，CountDownLatch"><a href="#7-1，CountDownLatch" class="headerlink" title="7.1，CountDownLatch"></a>7.1，CountDownLatch</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>对于多线程的开发，我们可以使用CountDownLatch来规定总线程的个数，并且使用它可以保证里面的所有线程执行完之后再放行</p>
<h3 id="代码-学生关门的例子"><a href="#代码-学生关门的例子" class="headerlink" title="代码[学生关门的例子]"></a>代码[学生关门的例子]</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread08;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-12 14:30</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 如门卫关门，教室里面有10个同学，必须所有同学全部出去之后再关门</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test01CountDownLatch</span> &#123;</span><br><span class="line">    <span class="comment">//创建一个减法计数器的对象  初始值为10</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CountDownLatch countDownLatch=<span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//模拟10个学生出门</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=<span class="number">10</span> ; i++) &#123;</span><br><span class="line">            Thread t=<span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot; 学生出门了&quot;</span>);</span><br><span class="line">                    <span class="comment">//说明有一个学生出去</span></span><br><span class="line">                    countDownLatch.countDown();<span class="comment">//做减法</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,<span class="string">&quot;学生&quot;</span>+i);</span><br><span class="line">            t.start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//阻塞判断countDownLatch计数器是否归零</span></span><br><span class="line">        countDownLatch.await();<span class="comment">//这个方法是一个阻塞的方法  计数器是否归零之后才会解除阻塞</span></span><br><span class="line">        System.out.println(<span class="string">&quot;关门&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-2，CyclicBarrier"><a href="#7-2，CyclicBarrier" class="headerlink" title="7.2，CyclicBarrier"></a>7.2，CyclicBarrier</h2><h3 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h3><p>记录执行的线程的总数，一但到达规定线程个数，就触发某一个操作</p>
<h3 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread08;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BrokenBarrierException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CyclicBarrier;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-12 14:43</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 现在有这么一个需求，现在要集齐小当家108张梁山好汉可以兑换小霸王学习机</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test02CyclicBarrier</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建加法记数器</span></span><br><span class="line">        CyclicBarrier cyclicBarrier=<span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(<span class="number">108</span>, <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;108个卡片集成成功，小霸王带回家吧&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=<span class="number">108</span> ; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;【&quot;</span>+Thread.currentThread().getName()+<span class="string">&quot;】卡片集成了&quot;</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        cyclicBarrier.await();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,<span class="string">&quot;卡片&quot;</span>+i).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="7-3-Semaphore【信号量】"><a href="#7-3-Semaphore【信号量】" class="headerlink" title="7.3,Semaphore【信号量】"></a>7.3,Semaphore【信号量】</h2><h3 id="作用-2"><a href="#作用-2" class="headerlink" title="作用"></a>作用</h3><p>​	Semaphore（信号量）是用来控制同时访问特定资源的线程数量，它通过协调各个线程，以保证合理的使用公共资源</p>
<h3 id="代码【模拟停车】"><a href="#代码【模拟停车】" class="headerlink" title="代码【模拟停车】"></a>代码【模拟停车】</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread08;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Semaphore;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-12 14:52</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test03Semaphore</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//设置信号量为3，也就是模拟有3个车位</span></span><br><span class="line">        Semaphore semaphore=<span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//模拟10辆车</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=<span class="number">10</span> ; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">//要一个车位</span></span><br><span class="line">                        semaphore.acquire();</span><br><span class="line">                        System.out.println(Thread.currentThread().getName()+<span class="string">&quot; 抢到了车位&quot;</span>);</span><br><span class="line">                        TimeUnit.SECONDS.sleep(<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">10</span>));</span><br><span class="line">                        System.out.println(Thread.currentThread().getName()+<span class="string">&quot; 离开了车位&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                        <span class="comment">//通知其它车可以进来了</span></span><br><span class="line">                        semaphore.release();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,<span class="string">&quot;车辆&quot;</span>+i).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="8，ThreadLocal"><a href="#8，ThreadLocal" class="headerlink" title="8，ThreadLocal"></a>8，ThreadLocal</h1><h2 id="8-1-ThreadLocal类简介"><a href="#8-1-ThreadLocal类简介" class="headerlink" title="8.1 ThreadLocal类简介"></a>8.1 <strong>ThreadLocal类</strong>简介</h2><p>它就是为每一个线程开辟一块独立的内存问题，不同的线程可以向这个空间里面入数据，而不会影响其它线程</p>
<p>解决线程里面的数据传递问题，可以让我们方法和调用都之间解耦</p>
<p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281836461.png" alt="1636702567696"></p>
<h2 id="8-2，相关方法"><a href="#8-2，相关方法" class="headerlink" title="8.2，相关方法"></a>8.2，相关方法</h2><p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281836445.jpg" alt="img"></p>
<h2 id="8-3，代码"><a href="#8-3，代码" class="headerlink" title="8.3，代码"></a>8.3，代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread09;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.c4rich.thread02.T;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.generic.NEW;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-12 15:27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestThreadLocal</span> &#123;</span><br><span class="line">    <span class="comment">//声明一个独立于线程的容器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;String&gt; threadLocal=<span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                String str=<span class="string">&quot;我是线程A里面放入的数据&quot;</span>;</span><br><span class="line">                threadLocal.set(str);</span><br><span class="line">                Utils.a();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;线程A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//                String str=&quot;我是线程B里面放入的数据&quot;;</span></span><br><span class="line"><span class="comment">//                threadLocal.set(str);</span></span><br><span class="line">                Utils.a();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;线程B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                String str=<span class="string">&quot;我是线程C里面放入的数据&quot;</span>;</span><br><span class="line">                threadLocal.set(str);</span><br><span class="line">                Utils.a();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;线程C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">Utils</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot; 值为：&quot;</span>+TestThreadLocal.threadLocal.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="09，阻塞队列【补充】"><a href="#09，阻塞队列【补充】" class="headerlink" title="09，阻塞队列【补充】"></a>09，阻塞队列【补充】</h1><h2 id="9-1-常见的BlockingQueue"><a href="#9-1-常见的BlockingQueue" class="headerlink" title="9.1 常见的BlockingQueue"></a>9.1 <strong>常见的BlockingQueue</strong></h2><p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281836788.png" alt="1636704842751"></p>
<h2 id="9-2，BlockingQueue概述"><a href="#9-2，BlockingQueue概述" class="headerlink" title="9.2，BlockingQueue概述"></a>9.2，BlockingQueue概述</h2><h3 id="相关方法"><a href="#相关方法" class="headerlink" title="相关方法"></a>相关方法</h3><p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281836347.png" alt="1636704963311"></p>
<h3 id="放入数据"><a href="#放入数据" class="headerlink" title="放入数据"></a><strong>放入数据</strong></h3><p>（1）offer(anObject):表示如果可能的话,将anObject加到BlockingQueue里,即如果BlockingQueue可以容纳,则返回true,否则返回false.（本方法不阻塞当前执行方法的线程）；　　　　　　 </p>
<p>（2）offer(E o, long timeout, TimeUnit unit)：可以设定等待的时间，如果在指定的时间内，还不能往队列中加入BlockingQueue，则返回失败。</p>
<p>（3）put(anObject):把anObject加到BlockingQueue里,如果BlockQueue没有空间,则调用此方法的线程被阻断直到BlockingQueue里面有空间再继续.</p>
<h3 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a><strong>获取数据</strong></h3><p>（1）poll(time):取走BlockingQueue里排在首位的对象,若不能立即取出,则可以等time参数规定的时间,取不到时返回null;</p>
<p>（2）poll(long timeout, TimeUnit unit)：从BlockingQueue取出一个队首的对象，如果在指定时间内，队列一旦有数据可取，则立即返回队列中的数据。否则直到时间超时还没有数据可取，返回失败。</p>
<p>（3）take():取走BlockingQueue里排在首位的对象,若BlockingQueue为空,阻断进入等待状态直到BlockingQueue有新的数据被加入; </p>
<h2 id="9-2，ArrayBlockingQueue"><a href="#9-2，ArrayBlockingQueue" class="headerlink" title="9.2，ArrayBlockingQueue"></a>9.2，ArrayBlockingQueue</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>它是一个基于数组的阻塞队列，底层使用数组去实现</p>
<h3 id="相关方法-1"><a href="#相关方法-1" class="headerlink" title="相关方法"></a>相关方法</h3><p>u add(E e)：把 e 加到 BlockingQueue 里，<strong>即如果 BlockingQueue 可以容纳，则返回 true，否则报异常</strong> </p>
<p>u offer(E e)：表示如果可能的话，将 e 加到 BlockingQueue 里<strong>，即如果 BlockingQueue 可以容纳，则返回 true，否则返回 false</strong> </p>
<p>u put(E e)：把 e 加到 BlockingQueue 里，如果 BlockQueue 没有空间，则调用此方法的线程被阻断直到 BlockingQueue 里面有空间再继续</p>
<p>u poll(time)：取走 BlockingQueue <strong>里排在首位的对象，若不能立即取出，则可以等 time 参数规定的时间,取不到时返回 null</strong> </p>
<p>u take()：取走 BlockingQueue 里排在首位的对象，若 BlockingQueue 为空，<strong>阻断进入等待状态直到 Blocking 有新的对象被加入为止</strong> </p>
<h3 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">package com.c4rich.thread10;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author </span><br><span class="line"> * @create 2021-11-12 16:22</span><br><span class="line"> *</span><br><span class="line"> * 基于数组的阻塞队列</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">public class Test01ArrayBlockingQueue &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        //声明一个阻塞队列</span><br><span class="line">        ArrayBlockingQueue&lt;String&gt; blockingQueue=new ArrayBlockingQueue&lt;&gt;(10);</span><br><span class="line">        //启动线程向队列里面每100毫秒放一条数据</span><br><span class="line">        new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                for (int i = 1; i &lt;=200 ; i++) &#123;</span><br><span class="line">                    System.out.println(blockingQueue.offer(&quot;hello--&quot;+i));</span><br><span class="line">//                    try &#123;</span><br><span class="line">//                        TimeUnit.MILLISECONDS.sleep(100);</span><br><span class="line">//                    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">//                        e.printStackTrace();</span><br><span class="line">//                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        //使用死循环去取</span><br><span class="line">        while (true)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                System.out.println(blockingQueue.take());</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h3><p> 先进先出队列（队列头的是最先进队的元素；队列尾的是最后进队的元素）</p>
<p> 有界队列（即初始化时指定的容量，就是队列最大的容量，不会出现扩容，容量满，则阻塞进队操作；容量空，则阻塞出队操作）</p>
<p> 队列不支持空元素</p>
<h2 id="9-3，LinkedBlockingQueue"><a href="#9-3，LinkedBlockingQueue" class="headerlink" title="9.3，LinkedBlockingQueue"></a>9.3，LinkedBlockingQueue</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>它是一个基于链表的阻塞队列</p>
<p>它是一个默认的无界队列，默认大小为Integer.MAX_VALUE</p>
<h3 id="相关构造方法"><a href="#相关构造方法" class="headerlink" title="相关构造方法"></a>相关构造方法</h3><p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281836084.png" alt="1636706291701"></p>
<h3 id="相关方法-2"><a href="#相关方法-2" class="headerlink" title="相关方法"></a>相关方法</h3><p>和BolckingQueue里面一样</p>
<h3 id="相关代码"><a href="#相关代码" class="headerlink" title="相关代码"></a>相关代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread10;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-12 16:22</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 基于链表阻塞队列</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test02LinkedBlockingQueue</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">         <span class="comment">//创建一个阻塞队列</span></span><br><span class="line">        LinkedBlockingQueue&lt;String&gt; blockingQueue=<span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//使用线程向队列里面放元素</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;=Integer.MAX_VALUE ; i++) &#123;</span><br><span class="line">                    System.out.println(blockingQueue.offer(<span class="string">&quot;hello-&quot;</span>+i));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                System.out.println(blockingQueue.take());</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="9-4，DelayQueue"><a href="#9-4，DelayQueue" class="headerlink" title="9.4，DelayQueue"></a>9.4，DelayQueue</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><p>它是无界队列</p>
<p>传的数据对象必须实现Delayed这个接口</p>
<p>如果延时时间没有到达，这个数据不能被取出</p>
<h3 id="相关代码-1"><a href="#相关代码-1" class="headerlink" title="相关代码"></a>相关代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread10;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.DelayQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Delayed;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-12 16:45</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 这是一个延时队列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test03DelayQueue</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        DelayQueue&lt;MyDelayedTask&gt; delayQueue=<span class="keyword">new</span> <span class="title class_">DelayQueue</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                delayQueue.offer(<span class="keyword">new</span> <span class="title class_">MyDelayedTask</span>(<span class="string">&quot;任务1&quot;</span>,<span class="number">3000</span>));</span><br><span class="line">                delayQueue.offer(<span class="keyword">new</span> <span class="title class_">MyDelayedTask</span>(<span class="string">&quot;任务2&quot;</span>,<span class="number">1000</span>));</span><br><span class="line">                delayQueue.offer(<span class="keyword">new</span> <span class="title class_">MyDelayedTask</span>(<span class="string">&quot;任务3&quot;</span>,<span class="number">1500</span>));</span><br><span class="line">                delayQueue.offer(<span class="keyword">new</span> <span class="title class_">MyDelayedTask</span>(<span class="string">&quot;任务4&quot;</span>,<span class="number">4000</span>));</span><br><span class="line">                delayQueue.offer(<span class="keyword">new</span> <span class="title class_">MyDelayedTask</span>(<span class="string">&quot;任务5&quot;</span>,<span class="number">8000</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(delayQueue.take());</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDelayedTask</span>  <span class="keyword">implements</span> <span class="title class_">Delayed</span>&#123;</span><br><span class="line">    <span class="comment">//任务名</span></span><br><span class="line">    <span class="keyword">private</span> String name ;</span><br><span class="line">    <span class="comment">//创建任务的时间</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="comment">//任务延时的时长</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> time;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyDelayedTask</span><span class="params">(String name, <span class="type">long</span> time)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.time = time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要实现的接口，获得延迟时间   用过期时间-当前时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getDelay</span><span class="params">(TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unit.convert((start+time)-System.currentTimeMillis(),TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对放入的任务进行排序</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Delayed o)</span> &#123;</span><br><span class="line">        <span class="type">MyDelayedTask</span> <span class="variable">o1</span> <span class="operator">=</span> (MyDelayedTask) o;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>) (<span class="built_in">this</span>.getDelay(TimeUnit.MILLISECONDS) - o.getDelay(TimeUnit.MILLISECONDS));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;MyDelayedTask&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="9-5-PriorityBlockingQueue"><a href="#9-5-PriorityBlockingQueue" class="headerlink" title="9.5,PriorityBlockingQueue"></a>9.5,PriorityBlockingQueue</h2><h3 id="概述-3"><a href="#概述-3" class="headerlink" title="概述"></a>概述</h3><p>基于优先级，放入的元素必须具有可排序的能力  要实现Comparable</p>
<h3 id="相关代码-2"><a href="#相关代码-2" class="headerlink" title="相关代码"></a>相关代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread10;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.PriorityBlockingQueue;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-12 16:56</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test04PriorityBlockingQueue</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建队列</span></span><br><span class="line">        PriorityBlockingQueue&lt;Person&gt; blockingQueue=<span class="keyword">new</span> <span class="title class_">PriorityBlockingQueue</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                blockingQueue.offer(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;p1&quot;</span>,<span class="number">22</span>));</span><br><span class="line">                blockingQueue.offer(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;p2&quot;</span>,<span class="number">12</span>));</span><br><span class="line">                blockingQueue.offer(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;p3&quot;</span>,<span class="number">10</span>));</span><br><span class="line">                blockingQueue.offer(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;p4&quot;</span>,<span class="number">32</span>));</span><br><span class="line">                blockingQueue.offer(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;p5&quot;</span>,<span class="number">21</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(blockingQueue.take());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span>&lt;Person&gt;&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Person o)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.age-o.age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="9-6，SynchronousQueue"><a href="#9-6，SynchronousQueue" class="headerlink" title="9.6，SynchronousQueue"></a>9.6，SynchronousQueue</h2><h3 id="概述-4"><a href="#概述-4" class="headerlink" title="概述"></a>概述</h3><p>它没有缓冲区，也就是使用这个队列，必须生产者和消费者同时存在</p>
<h3 id="相关代码-3"><a href="#相关代码-3" class="headerlink" title="相关代码"></a>相关代码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">package com.c4rich.thread10;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.SynchronousQueue;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author </span><br><span class="line"> * @create 2021-11-12 17:02</span><br><span class="line"> */</span><br><span class="line">public class Test05SynchronousQueue &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        //创建列表</span><br><span class="line">        SynchronousQueue&lt;String&gt; queue=new SynchronousQueue&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line"></span><br><span class="line">                for (int i = 1; i &lt;=5 ; i++) &#123;</span><br><span class="line">                    System.out.println(queue.offer(&quot;hello&quot;+i));</span><br><span class="line">                    try &#123;</span><br><span class="line">                        TimeUnit.SECONDS.sleep(1);</span><br><span class="line">                    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        while (true)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                System.out.println(queue.take());</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="10，线程池【补充】"><a href="#10，线程池【补充】" class="headerlink" title="10，线程池【补充】"></a>10，线程池【补充】</h1><h2 id="10-1-线程池的概念"><a href="#10-1-线程池的概念" class="headerlink" title="10.1 线程池的概念"></a>10.1 <strong>线程池</strong>的概念</h2><p>在前面的章节中，我们使用线程的时候就去创建一个线程，这样实现起来非常简便，但是就会有一个问题：</p>
<p>　　如果并发的线程数量很多，并且每个线程都是执行一个时间很短的任务就结束了，这样频繁创建线程就会大大降低系统的效率，因为系统启动一个新线程的成本是比较高的，它涉及到与操作系统的交互，频繁创建线程和销毁线程都需要时间。</p>
<p>在这种情况下，使用线程池可以很好的提供性能，尤其是当程序中需要创建<strong>大量生存期很短暂</strong>的线程时，更应该考虑使用线程池。</p>
<p>线程池在系统启动时即创建大量空闲的线程，程序将一个Runnable对象传给线程池，线程池就会启动一条线程来执行该对象的run方法，当run方法执行结束后，该线程并不会死亡，而是再次返回线程池中成为空闲状态，等待执行下一个Runnable对象的run方法。</p>
<p>除此之外，使用线程池可以有效地控制系统中并发线程的数量，但系统中包含大量并发线程时，会导致系统性能剧烈下降，甚至导致JVM崩溃。而线程池的最大线程数参数可以控制系统中并发的线程不超过此数目。</p>
<p>合理利用线程池能够带来三个好处：</p>
<p>1）降低资源消耗。通过重复利用已创建的线程降低线程创建和销毁造成的消耗。</p>
<p>2）提高响应速度。当任务到达时，任务可以不需要等到线程创建就能立即执行。</p>
<p>3）提高线程的可管理性。线程是稀缺资源，如果无限制的创建，不仅会消耗系统资源，还会降低系统的稳定性，使用线程池可以进行统一的分配，调优和监控。</p>
<p>在JDK1.5之前，开发者必须手动的实现自己的线程池，从JDK1.5之后，Java内建支持线程池。与多线程并发的所有支持的类都在java.lang.concurrent包中，我们可以使用里面的类更加的控制多线程的执行。</p>
<h2 id="10-2，Runnable与Callable详解"><a href="#10-2，Runnable与Callable详解" class="headerlink" title="10.2，Runnable与Callable详解"></a>10.2，Runnable与Callable详解</h2><h3 id="Runnable接口"><a href="#Runnable接口" class="headerlink" title="Runnable接口"></a><strong>Runnable</strong>接口</h3><p>先说一下java.lang.Runnable吧，它是一个接口，在它里面只声明了一个run()方法，在run()方法中封装的都是线程任务。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface Runnable &#123;</span><br><span class="line">    public abstract void run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Callable接口"><a href="#Callable接口" class="headerlink" title="Callable接口"></a><strong>Callable</strong>接口</h3><p>提交callable接口可以得到线程运行完成之后的返回值</p>
<h2 id="10-3，Executors线程池工具类"><a href="#10-3，Executors线程池工具类" class="headerlink" title="10.3，Executors线程池工具类"></a>10.3，Executors线程池工具类</h2><p>JDK1.5中提供Executors工厂类来产生线程池，该工厂类中包含如下的几个静态工程方法来创建线程池，我们只需要调用对应的静态方法就可以获的想要的线程池对象。</p>
<h3 id="10-3-1-newSingleThreadExecutor"><a href="#10-3-1-newSingleThreadExecutor" class="headerlink" title="10.3.1 newSingleThreadExecutor"></a>10.3.1 <strong>newSingleThreadExecutor</strong></h3><p>创建只有一个线程的线程池，当该线程正繁忙时，对于新任务会进入阻塞队列中(无界的阻塞队列)</p>
<h3 id="10-3-2-newFixedThreadPool"><a href="#10-3-2-newFixedThreadPool" class="headerlink" title="10.3.2 newFixedThreadPool"></a>10.3.2 <strong>newFixedThreadPool</strong></h3><p>创建可容纳固定数量线程的池子，每个线程的存活时间是无限的，当池子满了就不再添加线程了；如果池中的所有线程均在繁忙状态，对于新任务会进入阻塞队列中(无界的阻塞队列)</p>
<h3 id="10-3-3-newScheduledThreadPool"><a href="#10-3-3-newScheduledThreadPool" class="headerlink" title="10.3.3 newScheduledThreadPool"></a>10.3.3 <strong>newScheduledThreadPool</strong></h3><p>创建一个固定大小的线程池，线程池内线程存活时间无限制，线程池可以支持定时及周期性任务执行，如果所有线程均处于繁忙状态，对于新任务会进入DelayedWorkQueue队列中，这是一种按照超时时间排序的队列结构。 </p>
<h3 id="10-3-4-newCachedThreadPool"><a href="#10-3-4-newCachedThreadPool" class="headerlink" title="10.3.4 newCachedThreadPool"></a>10.3.4 <strong>newCachedThreadPool</strong></h3><p>它是一个可以无限扩大的线程池；它比较适合处理执行时间比较小的任务；corePoolSize为0，maximumPoolSize为无限大，意味着线程数量可以无限大；keepAliveTime为60S，意味着线程空闲时间超过60S就会被杀死；采用SynchronousQueue装等待的任务，这个阻塞队列没有存储空间，这意味着只要有请求到来，就必须要找到一条工作线程处理他，如果当前没有空闲的线程，那么就会再创建一条新的线程。</p>
<p>通过Executors工厂类可以生产两种类型的线程池对象，ExecutorService代表可尽快执行线程任务的线程池，ScheduleExecutorService代表可延迟执行线程任务的线程池，接下来我们就对这两种线程池来深入的讲解。</p>
<h2 id="10-4，ExecutorService接口"><a href="#10-4，ExecutorService接口" class="headerlink" title="10.4，ExecutorService接口"></a>10.4，ExecutorService接口</h2><p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281835780.jpg" alt="img"> </p>
<h3 id="10-4-1，使用Runnable提交任务"><a href="#10-4-1，使用Runnable提交任务" class="headerlink" title="10.4.1，使用Runnable提交任务"></a>10.4.1，使用Runnable提交任务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">package com.c4rich.thread11;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.ExecutorService;</span><br><span class="line">import java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author </span><br><span class="line"> * @create 2021-11-12 17:47</span><br><span class="line"> */</span><br><span class="line">public class Test03ThreadPool &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // 1.获取线程池对象,创建一个固定大小为2的线程池</span><br><span class="line">        ExecutorService threadPool = Executors.newFixedThreadPool(2);</span><br><span class="line">        //提交任务对象</span><br><span class="line">        threadPool.submit(new MyRunnable());</span><br><span class="line">        threadPool.submit(new MyRunnable());</span><br><span class="line">        threadPool.submit(new MyRunnable());</span><br><span class="line">        threadPool.submit(new MyRunnable());</span><br><span class="line">        threadPool.submit(new MyRunnable());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class MyRunnable implements Runnable &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        System.out.println(&quot;我要一个助教&quot;);</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(5000);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;助教来啦：&quot; + Thread.currentThread().getName());</span><br><span class="line">        System.out.println(&quot;助教帮我解决完问题后，继续回到助教的位置上面。&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="10-4-2，使用Callable提交任务"><a href="#10-4-2，使用Callable提交任务" class="headerlink" title="10.4.2，使用Callable提交任务"></a>10.4.2，使用Callable提交任务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package com.c4rich.thread11;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author </span><br><span class="line"> * @create 2021-11-12 17:47</span><br><span class="line"> */</span><br><span class="line">public class Test04ThreadPool &#123;</span><br><span class="line">    public static void main(String[] args) throws ExecutionException, InterruptedException &#123;</span><br><span class="line">        // 1.获取线程池对象,创建一个固定大小为2的线程池</span><br><span class="line">        ExecutorService threadPool = Executors.newFixedThreadPool(2);</span><br><span class="line">        //提交任务对象</span><br><span class="line">//        Future submit = threadPool.submit(new MyRunnable2());</span><br><span class="line">//        System.out.println(submit.get());//future类是当任务执行完成之后的返回值</span><br><span class="line">        threadPool.submit(new MyRunnable());</span><br><span class="line">        threadPool.submit(new MyRunnable2());</span><br><span class="line">        threadPool.submit(new MyRunnable2());</span><br><span class="line">        threadPool.submit(new MyRunnable2());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyRunnable2 implements Callable &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public Object call() throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;我要一个助教&quot;);</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(5000);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;助教来啦：&quot; + Thread.currentThread().getName());</span><br><span class="line">        System.out.println(&quot;助教帮我解决完问题后，继续回到助教的位置上面。&quot;);</span><br><span class="line">        return &quot;解决完成&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="注意点-1"><a href="#注意点-1" class="headerlink" title="注意点"></a>注意点</h3><p>runnable的任务提交之后返回的Future的get（）方法获取的值为null</p>
<p>callable的任务提交之后返回的Future的get()方法获取的值为线程执行完成之后返回值 </p>
<p>Future.get()方法是阻塞式的方法</p>
<h2 id="10-5，ThreadPoolExecutor类-重点"><a href="#10-5，ThreadPoolExecutor类-重点" class="headerlink" title="10.5，ThreadPoolExecutor类[重点]"></a>10.5，ThreadPoolExecutor类[重点]</h2><h3 id="核心参数"><a href="#核心参数" class="headerlink" title="核心参数"></a>核心参数</h3><p><img src="https://raw.githubusercontent.com/c4rich/imgs/main/imgs/202303281835964.png" alt="1636711942048"></p>
<p><strong>corePoolSize</strong> - 池中所保存的线程数，包括空闲线程，会一直存在，除非allowCoreThreadTimeOut设置为true。</p>
<p><strong>maximumPoolSize</strong>-池中允许的最大线程数。</p>
<p><strong>keepAliveTime</strong> - 当线程数大于核心时，此为终止前多余的空闲线程等待新任务的最长时间。</p>
<p><strong>unit</strong> - keepAliveTime 参数的时间单位。</p>
<p>workQueue - 执行前用于保持任务的队列。此队列仅保持由 execute方法提交的 Runnable任务。</p>
<p>threadFactory - 执行程序创建新线程时使用的工厂。</p>
<p>handler - 当线程已满，工作队列也满了的时候，会被调用。被用来实现各种拒绝策略。。</p>
<h3 id="拒绝策略说明"><a href="#拒绝策略说明" class="headerlink" title="拒绝策略说明"></a>拒绝策略说明</h3><p>当线程池的任务缓存队列已满并且线程池中的线程数目达到 maximumPoolSize，如果还有任务到来就会采取任务拒绝策略，拒绝策略有四种：</p>
<p>ThreadPoolExecutor.AbortPolicy : 丢弃任务并抛出 RejectedExecutionException 异常。【默认的】</p>
<p>ThreadPoolExecutor.DiscardPolicy ：也是丢弃任务，但是不抛出异常。</p>
<p>ThreadPoolExecutor.DiscardOldestPolicy ：丢弃队列最前面的任务，执行后面的任务</p>
<p>ThreadPoolExecutor.CallerRunsPolicy ：由调用线程处理该任务</p>
<h3 id="相关代码-4"><a href="#相关代码-4" class="headerlink" title="相关代码"></a>相关代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.c4rich.thread12;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.c4rich.thread02.T;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-11-12 18:17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test02ThreadPool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ThreadPoolExecutor executor=<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">                <span class="number">10</span>,  <span class="comment">//核心线程数</span></span><br><span class="line">                <span class="number">20</span>,<span class="comment">//最大线程数</span></span><br><span class="line">                <span class="number">60</span>,<span class="comment">//回收线程的时长</span></span><br><span class="line">                TimeUnit.SECONDS,<span class="comment">//回收线程时长的单位</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">10</span>),<span class="comment">//阻塞队列</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ThreadFactory</span>() &#123;<span class="comment">//线程创建工厂</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> Thread <span class="title function_">newThread</span><span class="params">(Runnable r)</span> &#123;</span><br><span class="line"><span class="comment">//                        System.out.println(&quot;有线程被创建&quot;);</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">RejectedExecutionHandler</span>() &#123;<span class="comment">//拒绝策略</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor executor)</span> &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;触发拒绝策略&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//提交40个任务</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=<span class="number">30</span> ; i++) &#123;</span><br><span class="line">            executor.submit(<span class="keyword">new</span> <span class="title class_">MyTask2</span>(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyTask2</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyTask2</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.i=i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;---&quot;</span>+i);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://c4rich.github.io">c4rich</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://c4rich.github.io/2023/03/19/%E7%BA%BF%E7%A8%8B/">https://c4rich.github.io/2023/03/19/%E7%BA%BF%E7%A8%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://c4rich.github.io" target="_blank">飘渺之旅</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/Javase/">Javase</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/03/19/%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" title="流程控制"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">流程控制</div></div></a></div><div class="next-post pull-right"><a href="/2023/03/19/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">设计模式</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/03/19/IO%E6%B5%81/" title="IO流"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-19</div><div class="title">IO流</div></div></a></div><div><a href="/2023/03/19/XML%E5%92%8CJSON%E8%A7%A3%E6%9E%90/" title="XML和JSON解析"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-19</div><div class="title">XML和JSON解析</div></div></a></div><div><a href="/2023/03/19/lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8CStream/" title="lambda表达式和Stream"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-19</div><div class="title">lambda表达式和Stream</div></div></a></div><div><a href="/2023/03/19/%E5%88%9D%E8%AF%86Java/" title="初识Java"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-19</div><div class="title">初识Java</div></div></a></div><div><a href="/2023/03/19/%E5%8F%8D%E5%B0%84%E5%92%8C%E6%B3%A8%E8%A7%A3/" title="反射和注解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-19</div><div class="title">反射和注解</div></div></a></div><div><a href="/2023/03/19/%E5%BC%82%E5%B8%B8/" title="异常"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-19</div><div class="title">异常</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">c4rich</div><div class="author-info__description">人生漫漫，身处何处不飘摇</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/c4rich" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:75302@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1%EF%BC%8C%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">1，概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1%EF%BC%8C%E7%A8%8B%E5%BA%8F%EF%BC%8C%E8%BF%9B%E7%A8%8B%EF%BC%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.1.</span> <span class="toc-text">1.1，程序，进程，线程的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2%EF%BC%8C%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%A8%8B%E5%BA%8F%E5%92%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.2.</span> <span class="toc-text">1.2，单线程程序和多线程程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3%EF%BC%8CJAVA%E7%A8%8B%E5%BA%8F%E7%9A%84%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">1.3，JAVA程序的运行原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4%EF%BC%8C%E5%B9%B6%E5%8F%91%E5%92%8C%E5%B9%B6%E8%A1%8C%E7%9A%84%E8%AF%B4%E6%98%8E"><span class="toc-number">1.4.</span> <span class="toc-text">1.4，并发和并行的说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-1%EF%BC%8C%E5%B9%B6%E5%8F%91"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.4.1，并发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-2%EF%BC%8C%E5%B9%B6%E8%A1%8C"><span class="toc-number">1.4.2.</span> <span class="toc-text">1.4.2，并行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5%EF%BC%8C%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%92%8C%E5%B9%B6%E8%A1%8C%E7%BC%96%E7%A8%8B"><span class="toc-number">1.5.</span> <span class="toc-text">1.5，并发编程和并行编程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%EF%BC%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">2，线程的创建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1%EF%BC%8CThread-%E7%B1%BB%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.1.</span> <span class="toc-text">2.1，Thread 类介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.1.</span> <span class="toc-text">相关属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-number">2.1.2.</span> <span class="toc-text">构造方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2%EF%BC%8C%E7%BB%A7%E6%89%BFThread%E7%B1%BB"><span class="toc-number">2.2.</span> <span class="toc-text">2.2，继承Thread类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3%EF%BC%8C%E5%AE%9E%E7%8E%B0Runnable%E6%8E%A5%E5%8F%A3"><span class="toc-number">2.3.</span> <span class="toc-text">2.3，实现Runnable接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.3.1.</span> <span class="toc-text">步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">2.3.2.</span> <span class="toc-text">代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%8C%BF%E5%90%8D%E5%86%85%E9%83%A8%E7%B1%BB"><span class="toc-number">2.4.</span> <span class="toc-text">2.4，使用匿名内部类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4%EF%BC%8C%E4%BD%BF%E7%94%A8Lambad"><span class="toc-number">2.5.</span> <span class="toc-text">2.4，使用Lambad</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%EF%BC%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">3.</span> <span class="toc-text">3，线程的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1%EF%BC%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">3.1.</span> <span class="toc-text">3.1，线程的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E7%8A%B6%E6%80%81%EF%BC%88New%EF%BC%89"><span class="toc-number">3.1.1.</span> <span class="toc-text">新建状态（New）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%B1%E7%BB%AA%E7%8A%B6%E6%80%81%EF%BC%88Runnable%EF%BC%89"><span class="toc-number">3.1.2.</span> <span class="toc-text">就绪状态（Runnable）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81%EF%BC%88Running%EF%BC%89"><span class="toc-number">3.1.3.</span> <span class="toc-text">运行状态（Running）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BB%E5%A1%9E%E7%8A%B6%E6%80%81%EF%BC%88Blocked%EF%BC%89"><span class="toc-number">3.1.4.</span> <span class="toc-text">阻塞状态（Blocked）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%BB%E4%BA%A1%E7%8A%B6%E6%80%81%EF%BC%88Dead%EF%BC%89"><span class="toc-number">3.1.5.</span> <span class="toc-text">死亡状态（Dead）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2%EF%BC%8C-%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81%E7%9A%84%E6%8E%A7%E5%88%B6"><span class="toc-number">3.2.</span> <span class="toc-text">3.2， 线程状态的控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">3.2.1.</span> <span class="toc-text">线程的优先级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E7%9D%A1%E7%9C%A0"><span class="toc-number">3.2.2.</span> <span class="toc-text">线程睡眠</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E8%AE%A9%E6%AD%A5"><span class="toc-number">3.2.3.</span> <span class="toc-text">线程让步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%90%88%E5%B9%B6"><span class="toc-number">3.2.4.</span> <span class="toc-text">线程的合并</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B"><span class="toc-number">3.2.5.</span> <span class="toc-text">守护线程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4%EF%BC%8C%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5"><span class="toc-number">4.</span> <span class="toc-text">4，线程同步</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%90%8C%E6%AD%A5%E4%BB%A3%E7%A0%81%E5%9D%97%E8%AF%A6%E8%A7%A3"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 同步代码块详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">4.1.1.</span> <span class="toc-text">语法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2%E5%90%8C%E6%AD%A5%E6%96%B9%E6%B3%95-%E9%9D%9E%E9%9D%99%E6%80%81"><span class="toc-number">4.2.</span> <span class="toc-text">4.2同步方法[非静态]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">语法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3%E7%9B%91%E8%A7%86%E5%99%A8%E5%8F%AF%E4%BB%A5%E4%B8%BA%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6"><span class="toc-number">4.3.</span> <span class="toc-text">4.3监视器可以为字节码文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4%E5%90%8C%E6%AD%A5%E6%96%B9%E6%B3%95-%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="toc-number">4.4.</span> <span class="toc-text">4.4同步方法[静态方法]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-2"><span class="toc-number">4.4.1.</span> <span class="toc-text">语法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-synchronized%E6%80%BB%E7%BB%93"><span class="toc-number">4.5.</span> <span class="toc-text">4.5,synchronized总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6%EF%BC%8C%E6%AD%BB%E9%94%81"><span class="toc-number">4.6.</span> <span class="toc-text">4.6，死锁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="toc-number">4.6.1.</span> <span class="toc-text">原理图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-1"><span class="toc-number">4.6.2.</span> <span class="toc-text">代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-7%EF%BC%8C%E4%BD%9C%E4%B8%9A%E3%80%90%E8%BF%87%E5%B1%B1%E6%B4%9E%E3%80%91"><span class="toc-number">4.7.</span> <span class="toc-text">4.7，作业【过山洞】</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5%EF%BC%8C%E7%BA%BF%E7%A8%8B%E9%80%9A%E8%AE%AF"><span class="toc-number">5.</span> <span class="toc-text">5，线程通讯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E7%AD%89%E5%BE%85%E5%94%A4%E9%86%92%E6%96%B9%E6%B3%95"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 等待唤醒方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2%EF%BC%8Csleep-%E5%92%8C-wait-%E6%96%B9%E6%B3%95%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">5.2.</span> <span class="toc-text">5.2，sleep()和 wait()方法的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3%EF%BC%8C%E5%8D%95%E7%94%9F%E4%BA%A7%E8%80%85%E5%92%8C%E5%8D%95%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">5.3.</span> <span class="toc-text">5.3，单生产者和单消费者</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4%EF%BC%8C%E5%A4%9A%E7%94%9F%E4%BA%A7%E8%80%85%E5%92%8C%E5%A4%9A%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">5.4.</span> <span class="toc-text">5.4，多生产者和多消费者</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-Lock%E9%94%81"><span class="toc-number">6.</span> <span class="toc-text">6,Lock锁</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1%EF%BC%8C-synchronized%E7%9A%84%E7%BC%BA%E9%99%B7"><span class="toc-number">6.1.</span> <span class="toc-text">6.1， synchronized的缺陷</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2%EF%BC%8CLock%E6%8E%A5%E5%8F%A3%E8%AF%A6%E8%A7%A3"><span class="toc-number">6.2.</span> <span class="toc-text">6.2，Lock接口详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E9%87%8D%E7%82%B9%E6%96%B9%E6%B3%95"><span class="toc-number">6.2.1.</span> <span class="toc-text">相关重点方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lock%E9%94%81%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AF%AD%E6%B3%95"><span class="toc-number">6.2.2.</span> <span class="toc-text">Lock锁的使用语法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3%EF%BC%8C%E4%BD%BF%E7%94%A8Lock%E5%8E%BB%E6%94%B9%E7%94%9F%E4%BA%A7%E8%80%85%E5%92%8C%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">6.3.</span> <span class="toc-text">6.3，使用Lock去改生产者和消费者</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7%EF%BC%8C%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">7.</span> <span class="toc-text">7，并发编程工具类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1%EF%BC%8CCountDownLatch"><span class="toc-number">7.1.</span> <span class="toc-text">7.1，CountDownLatch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">7.1.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-%E5%AD%A6%E7%94%9F%E5%85%B3%E9%97%A8%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">7.1.2.</span> <span class="toc-text">代码[学生关门的例子]</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2%EF%BC%8CCyclicBarrier"><span class="toc-number">7.2.</span> <span class="toc-text">7.2，CyclicBarrier</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-1"><span class="toc-number">7.2.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-2"><span class="toc-number">7.2.2.</span> <span class="toc-text">代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-Semaphore%E3%80%90%E4%BF%A1%E5%8F%B7%E9%87%8F%E3%80%91"><span class="toc-number">7.3.</span> <span class="toc-text">7.3,Semaphore【信号量】</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-2"><span class="toc-number">7.3.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E3%80%90%E6%A8%A1%E6%8B%9F%E5%81%9C%E8%BD%A6%E3%80%91"><span class="toc-number">7.3.2.</span> <span class="toc-text">代码【模拟停车】</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8%EF%BC%8CThreadLocal"><span class="toc-number">8.</span> <span class="toc-text">8，ThreadLocal</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-ThreadLocal%E7%B1%BB%E7%AE%80%E4%BB%8B"><span class="toc-number">8.1.</span> <span class="toc-text">8.1 ThreadLocal类简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2%EF%BC%8C%E7%9B%B8%E5%85%B3%E6%96%B9%E6%B3%95"><span class="toc-number">8.2.</span> <span class="toc-text">8.2，相关方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3%EF%BC%8C%E4%BB%A3%E7%A0%81"><span class="toc-number">8.3.</span> <span class="toc-text">8.3，代码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#09%EF%BC%8C%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%E3%80%90%E8%A1%A5%E5%85%85%E3%80%91"><span class="toc-number">9.</span> <span class="toc-text">09，阻塞队列【补充】</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-%E5%B8%B8%E8%A7%81%E7%9A%84BlockingQueue"><span class="toc-number">9.1.</span> <span class="toc-text">9.1 常见的BlockingQueue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2%EF%BC%8CBlockingQueue%E6%A6%82%E8%BF%B0"><span class="toc-number">9.2.</span> <span class="toc-text">9.2，BlockingQueue概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%96%B9%E6%B3%95"><span class="toc-number">9.2.1.</span> <span class="toc-text">相关方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BE%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">9.2.2.</span> <span class="toc-text">放入数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">9.2.3.</span> <span class="toc-text">获取数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2%EF%BC%8CArrayBlockingQueue"><span class="toc-number">9.3.</span> <span class="toc-text">9.2，ArrayBlockingQueue</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">9.3.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%96%B9%E6%B3%95-1"><span class="toc-number">9.3.2.</span> <span class="toc-text">相关方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-3"><span class="toc-number">9.3.3.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-number">9.3.4.</span> <span class="toc-text">注意点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3%EF%BC%8CLinkedBlockingQueue"><span class="toc-number">9.4.</span> <span class="toc-text">9.3，LinkedBlockingQueue</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-number">9.4.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-number">9.4.2.</span> <span class="toc-text">相关构造方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%96%B9%E6%B3%95-2"><span class="toc-number">9.4.3.</span> <span class="toc-text">相关方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81"><span class="toc-number">9.4.4.</span> <span class="toc-text">相关代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4%EF%BC%8CDelayQueue"><span class="toc-number">9.5.</span> <span class="toc-text">9.4，DelayQueue</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-2"><span class="toc-number">9.5.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81-1"><span class="toc-number">9.5.2.</span> <span class="toc-text">相关代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-5-PriorityBlockingQueue"><span class="toc-number">9.6.</span> <span class="toc-text">9.5,PriorityBlockingQueue</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-3"><span class="toc-number">9.6.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81-2"><span class="toc-number">9.6.2.</span> <span class="toc-text">相关代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-6%EF%BC%8CSynchronousQueue"><span class="toc-number">9.7.</span> <span class="toc-text">9.6，SynchronousQueue</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-4"><span class="toc-number">9.7.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81-3"><span class="toc-number">9.7.2.</span> <span class="toc-text">相关代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10%EF%BC%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0%E3%80%90%E8%A1%A5%E5%85%85%E3%80%91"><span class="toc-number">10.</span> <span class="toc-text">10，线程池【补充】</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">10.1.</span> <span class="toc-text">10.1 线程池的概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2%EF%BC%8CRunnable%E4%B8%8ECallable%E8%AF%A6%E8%A7%A3"><span class="toc-number">10.2.</span> <span class="toc-text">10.2，Runnable与Callable详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Runnable%E6%8E%A5%E5%8F%A3"><span class="toc-number">10.2.1.</span> <span class="toc-text">Runnable接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Callable%E6%8E%A5%E5%8F%A3"><span class="toc-number">10.2.2.</span> <span class="toc-text">Callable接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-3%EF%BC%8CExecutors%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">10.3.</span> <span class="toc-text">10.3，Executors线程池工具类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-1-newSingleThreadExecutor"><span class="toc-number">10.3.1.</span> <span class="toc-text">10.3.1 newSingleThreadExecutor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-2-newFixedThreadPool"><span class="toc-number">10.3.2.</span> <span class="toc-text">10.3.2 newFixedThreadPool</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-3-newScheduledThreadPool"><span class="toc-number">10.3.3.</span> <span class="toc-text">10.3.3 newScheduledThreadPool</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-4-newCachedThreadPool"><span class="toc-number">10.3.4.</span> <span class="toc-text">10.3.4 newCachedThreadPool</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-4%EF%BC%8CExecutorService%E6%8E%A5%E5%8F%A3"><span class="toc-number">10.4.</span> <span class="toc-text">10.4，ExecutorService接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-1%EF%BC%8C%E4%BD%BF%E7%94%A8Runnable%E6%8F%90%E4%BA%A4%E4%BB%BB%E5%8A%A1"><span class="toc-number">10.4.1.</span> <span class="toc-text">10.4.1，使用Runnable提交任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-2%EF%BC%8C%E4%BD%BF%E7%94%A8Callable%E6%8F%90%E4%BA%A4%E4%BB%BB%E5%8A%A1"><span class="toc-number">10.4.2.</span> <span class="toc-text">10.4.2，使用Callable提交任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E7%82%B9-1"><span class="toc-number">10.4.3.</span> <span class="toc-text">注意点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-5%EF%BC%8CThreadPoolExecutor%E7%B1%BB-%E9%87%8D%E7%82%B9"><span class="toc-number">10.5.</span> <span class="toc-text">10.5，ThreadPoolExecutor类[重点]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%8F%82%E6%95%B0"><span class="toc-number">10.5.1.</span> <span class="toc-text">核心参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5%E8%AF%B4%E6%98%8E"><span class="toc-number">10.5.2.</span> <span class="toc-text">拒绝策略说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81-4"><span class="toc-number">10.5.3.</span> <span class="toc-text">相关代码</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/03/19/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E8%BF%90%E7%AE%97%E7%AC%A6/" title="数据类型和运算符">数据类型和运算符</a><time datetime="2023-03-19T15:33:03.000Z" title="发表于 2023-03-19 23:33:03">2023-03-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/03/19/IO%E6%B5%81/" title="IO流">IO流</a><time datetime="2023-03-19T15:12:40.000Z" title="发表于 2023-03-19 23:12:40">2023-03-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/03/19/XML%E5%92%8CJSON%E8%A7%A3%E6%9E%90/" title="XML和JSON解析">XML和JSON解析</a><time datetime="2023-03-19T15:12:40.000Z" title="发表于 2023-03-19 23:12:40">2023-03-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/03/19/lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8CStream/" title="lambda表达式和Stream">lambda表达式和Stream</a><time datetime="2023-03-19T15:12:40.000Z" title="发表于 2023-03-19 23:12:40">2023-03-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/03/19/%E5%88%9D%E8%AF%86Java/" title="初识Java">初识Java</a><time datetime="2023-03-19T15:12:40.000Z" title="发表于 2023-03-19 23:12:40">2023-03-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By c4rich</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://c4rich.github.io/2023/03/19/%E7%BA%BF%E7%A8%8B/'
    this.page.identifier = '/2023/03/19/%E7%BA%BF%E7%A8%8B/'
    this.page.title = '线程'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Valine' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>